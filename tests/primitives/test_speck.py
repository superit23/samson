from samson.block_ciphers.speck import Speck
from samson.utilities.bytes import Bytes
import unittest

# https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=da7a0ab5b4babbe5d7a46f852582be06a00a28f0
class SpeckTestCase(unittest.TestCase):
    def _run_test(self, key, block_size, pt, ct):
        speck = Speck(Bytes(key, 'little'), block_size)

        genned_ct = speck.encrypt(Bytes(pt, 'little'))
        self.assertEqual(genned_ct, Bytes(ct, 'little'))
        self.assertEqual(speck.decrypt(genned_ct), pt)
    

    def test_128_128(self):
        key = b'\x00\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f'
        pt  = b'\x20\x6d\x61\x64\x65\x20\x69\x74\x20\x65\x71\x75\x69\x76\x61\x6c'
        ct  = b'\x18\x0d\x57\x5c\xdf\xfe\x60\x78\x65\x32\x78\x79\x51\x98\x5d\xa6'
        bs  = 128
        self._run_test(key, bs, pt, ct)


    def test_128_192(self):
        key = b'\x00\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17'
        pt  = b'\x65\x6e\x74\x20\x74\x6f\x20\x43\x68\x69\x65\x66\x20\x48\x61\x72'
        ct  = b'\x86\x18\x3c\xe0\x5d\x18\xbc\xf9\x66\x55\x13\x13\x3a\xcf\xe4\x1b'
        bs  = 128
        self._run_test(key, bs, pt, ct)


    def test_128_256(self):
        key = b'\x00\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f'
        pt  = b'\x70\x6f\x6f\x6e\x65\x72\x2e\x20\x49\x6e\x20\x74\x68\x6f\x73\x65'
        ct  = b'\x43\x8f\x18\x9c\x8d\xb4\xee\x4e\x3e\xf5\xc0\x05\x04\x01\x09\x41'
        bs  = 128
        self._run_test(key, bs, pt, ct)


    def test_64_96(self):
        key = b'\x00\x01\x02\x03\x08\x09\x0a\x0b\x10\x11\x12\x13'
        pt  = b'\x65\x61\x6e\x73\x20\x46\x61\x74'
        ct  = b'\x6c\x94\x75\x41\xec\x52\x79\x9f'
        bs  = 64
        self._run_test(key, bs, pt, ct)


    def test_64_128(self):
        key = b'\x00\x01\x02\x03\x08\x09\x0a\x0b\x10\x11\x12\x13\x18\x19\x1a\x1b'
        pt  = b'\x2d\x43\x75\x74\x74\x65\x72\x3b'
        ct  = b'\x8b\x02\x4e\x45\x48\xa5\x6f\x8c'
        bs  = 64
        self._run_test(key, bs, pt, ct)
